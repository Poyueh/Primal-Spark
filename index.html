<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s5 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s6 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s9 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s10 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">html</span><span class="s5"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s1">"zh-TW"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s6">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s5"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">title</span><span class="s3">&gt;</span><span class="s1">åŸåˆä¹‹ç« Primal Spark</span><span class="s3">&lt;/</span><span class="s4">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- 1. è¼‰å…¥ Tailwind CSS (æ¨£å¼) --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- 2. è¼‰å…¥ Babel (è®“ç€è¦½å™¨çœ‹å¾—æ‡‚ React) --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://unpkg.com/@babel/standalone/babel.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- è¨­å®šé é¢æ¨£å¼ --&gt;</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s4">body</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s1">margin:</span><span class="s5"> </span><span class="s8">0</span><span class="s7">;</span><span class="s5"> </span><span class="s1">overflow:</span><span class="s5"> </span><span class="s6">hidden</span><span class="s7">;</span><span class="s5"> </span><span class="s1">background-color:</span><span class="s5"> #111</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">/* å®šç¾©åƒç´ å­—é«” */</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s9">@import</span><span class="s5"> </span><span class="s6">url</span><span class="s7">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=VT323&amp;display=swap'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">/* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s2">width:</span><span class="s5"> </span><span class="s8">10px</span><span class="s7">;</span><span class="s5"> </span><span class="s2">height:</span><span class="s5"> </span><span class="s8">10px</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-track</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s2">background:</span><span class="s5"> #1a1a1a</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-thumb</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s2">background:</span><span class="s5"> #4a4a4a</span><span class="s7">;</span><span class="s5"> </span><span class="s2">border-radius:</span><span class="s5"> </span><span class="s8">5px</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-thumb:hover</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s2">background:</span><span class="s5"> #666</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- React æ‡‰ç”¨ç¨‹å¼æ›è¼‰é» --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"root"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- 3. éŠæˆ²ä¸»ç¨‹å¼ --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text/babel"</span><span class="s5"> </span><span class="s2">data-type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>import React, { useState, useEffect, useRef, useCallback } from 'https://esm.sh/react@18.2.0?dev';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client?dev';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>import { Sparkles, Heart, Utensils, Shield, CloudRain, Snowflake, Sun, Cloud, Flame, Mountain, Skull, RefreshCw, X, Brain, ScrollText, MessageCircle, HelpCircle } from 'https://esm.sh/lucide-react@0.263.1?dev';</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- API Key è¨­å®š ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const apiKey = "";<span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- éŠæˆ²é‚è¼¯ ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const PIXEL_FONT = "'Courier New', Courier, monospace";</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const TILE_SIZE = 32;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const SCALE = 2.0; // èª¿æ•´ç‚º 2.0ï¼Œé©ä¸­çš„å¤§å°</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const PALETTE = {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>OUTLINE: '#1a1c2c',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>SKIN: '#ffccaa',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>SKIN_SHADOW: '#d48e7e',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>GRASS_BG: '#388e3c',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>GRASS_L: '#4caf50',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>GRASS_D: '#1b5e20',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>DIRT: '#5d4037',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WATER: '#4a69bd',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHEAT_1: '#a5d6a7',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHEAT_2: '#e6ee9c',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHEAT_3: '#fbc02d',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>STONE_L: '#b0bec5',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>STONE_M: '#78909c',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>STONE_D: '#546e7a',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WOOD_L: '#8d6e63',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WOOD_D: '#3e2723',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>LEAF_L: '#66bb6a',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>LEAF_D: '#2e7d32',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>LEAF_PINE: '#1b5e20',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FLOWER_R: '#e57373',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FLOWER_Y: '#fff176',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>MUSHROOM: '#f44336',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FUR_WOLF: '#90a4ae',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FUR_BEAR: '#4e342e',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FUR_DEER: '#a1887f',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FUR_RABBIT: '#fafafa',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHITE: '#ffffff',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>TRANSPARENT: null</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const callGemini = async (prompt) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!apiKey) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.warn("API Key æœªè¨­å®šï¼Œè·³é AI è«‹æ±‚");</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>try {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const response = await fetch(</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>method: 'POST',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>headers: { 'Content-Type': 'application/json' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>body: JSON.stringify({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>contents: [{ parts: [{ text: prompt }] }]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>})</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const data = await response.json();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return data.candidates?.[0]?.content?.parts?.[0]?.text || null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} catch (error) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.error("Gemini API Error:", error);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const SPRITE_MATRICES = {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>CHAR_M: ["........................",".......HHHHHH...........","......HSSSSSSH..........",".....HSSKSSKSSH.........",".....HSSSSSSSSH.........","......SSSSSSSS..........","....CCCSCCCCSCCC........","....CCCSCCCCSCCC........","....CCCCCCCCCCCC........","....KKKCCCCCCKKK........","....K.KCCCCCCK.K........","......KSSSSSSK..........","......KSSSSSSK..........","......KKK..KKK.........."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>CHAR_F: ["........................","......HHHHHHHH..........",".....HSSSSSSSSH.........",".....HSSKSSKSSH.........",".....HSSSSSSSSH.........",".....SSSSSSSSSS.........","....CCCSCCCCSCCC........","...CCCCSCCCCSCCCC.......","...CCCCCCCCCCCCCC.......","...CCCCCCCCCCCCCC.......","....CCCCCCCCCCCC........",".....KSSSSSSssk.........",".....KSSSSSSssk.........",".....KKK....KKK........."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>TREE_OAK: [".......LLLLLL.......",".....LLLLLLLLLL.....","....LLLLLLLLLLLL....","...LLLLLLLLLLLLLL...","...LLLLLLLLLLLLLL...","....LLLLLLLLLLLL....",".....LLLLLLLLLL.....",".......WWWWWW.......",".......WWWWWW.......",".......WWWWWW.......","......WWWWWWWW......"],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>TREE_PINE: ["..........L.........",".........LLL........","........LLLLL.......",".......LLLLLLL......",".........LLL........","........LLLLL.......",".......LLLLLLL......","......LLLLLLLLL.....",".....LLLLLLLLLLL....","........WWWWW.......",".......WWWWWWW......"],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>BUSH: ["....................","......LLLLLLL.......",".....LLLLLLLLL......","....LLLLLLLLLLL.....","....LLLLLLLLLLL.....",".....LLLLLLLLL......"],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>FLOWER: [".........R..........","........RYR.........",".........R..........",".........G..........",".........G.........."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>MUSHROOM: ["........RRR.........",".......RRRRR........",".......RWWWR........","........WWW.........","........WWW........."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ROCK: [".......KKKKKK.......",".....KKMMMMMMKK.....","....KMMLLLLLLMMK....","...KMLLLLLLLLLLMK...","...KMMMMMMMMMMMMK...","...KDDDDDDDDDDDDK...","....KKDDDDDDDDKK....","......KKKKKKKK......"],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>RABBIT: [".......KK...........","......KWWK..........",".....KWWWWK.........",".....KWWWWK.........","......KKKK.........."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WOLF: ["....................",".......K............","......KGK...........",".....KGGGK..........","....KGGGGGK...K.....","...KGGGGGGGGKKGK....","...KGGGGGGGGGGGK....","....KGGGGGGGGGK.....","....K.K.....K.K....."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>BEAR: [".........KK...KK....","......KKKBBKKKBBK...",".....KBBBBBBBBBBBK..","....KBBBBBBBBBBBBBK.","...KBBBBBBBBBBBBBBBK","...KBBBBBBBBBBBBBBBK","...KBBBBBBBBBBBBBBBK","....KB.B.B.....B.B..","....KK.K.K.....K.K.."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>DEER: ["...........K...K....","............K.K.....","..........KKKBKK....",".........KBBBBBBK...","........KBBBBBBBBK..",".......KBBBBBBBBBK..",".......K.B.....B....",".......K.K.....K...."],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHEAT_GROW: ["................","....1......1....","...111....111...","....1......1....","................"],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>WHEAT_READY: ["....3......3....","...333....333...","...333....333...","....3......3....","....3......3...."]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const MAP_WIDTH = 24;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const MAP_HEIGHT = 24;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const DAY_TICKS = 800;<span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const WEATHER = {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>SUNNY: { id: 'SUNNY', name: 'æ™´å¤©', color: 'rgba(255,255,0,0.1)' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>RAIN: { id: 'RAIN', name: 'é›¨å¤©', color: 'rgba(0,0,50,0.3)' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>SNOW: { id: 'SNOW', name: 'é™é›ª', color: 'rgba(200,240,255,0.2)' }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const ZODIACS = [</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'ç‰¡ç¾Š', gender: 'M', color: '#c0392b', hair: '#2c3e50', trait: 'å¥½é¬¥' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'é‡‘ç‰›', gender: 'F', color: '#27ae60', hair: '#5d4037', trait: 'å›ºåŸ·' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'é›™å­', gender: 'M', color: '#f39c12', hair: '#e67e22', trait: 'å–„è®Š' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'å·¨èŸ¹', gender: 'F', color: '#7f8c8d', hair: '#34495e', trait: 'é¡§å®¶' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'ç…å­', gender: 'M', color: '#e67e22', hair: '#f1c40f', trait: 'éœ¸æ°£' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'è™•å¥³', gender: 'F', color: '#16a085', hair: '#2ecc71', trait: 'è¬¹æ…' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'å¤©ç§¤', gender: 'M', color: '#e84393', hair: '#fd79a8', trait: 'çŒ¶è±«' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'å¤©è ', gender: 'F', color: '#8e44ad', hair: '#2c3e50', trait: 'æ•éŠ³' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'å°„æ‰‹', gender: 'M', color: '#2980b9', hair: '#3498db', trait: 'å†’éšª' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'æ‘©ç¾¯', gender: 'F', color: '#576574', hair: '#1e272e', trait: 'å …å¿' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'æ°´ç“¶', gender: 'M', color: '#00d2d3', hair: '#00cec9', trait: 'å¤æ€ª' },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>{ sign: 'é›™é­š', gender: 'F', color: '#a29bfe', hair: '#6c5ce7', trait: 'æµªæ¼«' }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>];</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const rand = (min, max) =&gt; Math.floor(Math.random() * (max - min + 1)) + min;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const noise = (x, y) =&gt; Math.sin(x/3.5) + Math.cos(y/4.5);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const renderMatrix = (ctx, matrix, colors, offsetX = 0, offsetY = 0) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>matrix.forEach((row, y) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>for (let x = 0; x &lt; row.length; x++) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const char = row[x];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (char === '.') continue;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let fill = colors[char] || PALETTE.OUTLINE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (char === 'K') fill = PALETTE.OUTLINE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = fill;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillRect(offsetX + x, offsetY + y, 1, 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const createSprites = () =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const cache = {};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const createCanvas = (w, h) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const c = document.createElement('canvas');</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>c.width = w; c.height = h;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return { c, ctx: c.getContext('2d') };</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: grassC, ctx: grassCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>grassCtx.fillStyle = PALETTE.GRASS_BG; grassCtx.fillRect(0, 0, TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>grassCtx.fillStyle = PALETTE.GRASS_L; for(let i=0; i&lt;30; i++) grassCtx.fillRect(rand(0,31), rand(0,31), 1, 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>grassCtx.fillStyle = PALETTE.GRASS_D; for(let i=0; i&lt;20; i++) grassCtx.fillRect(rand(0,31), rand(0,31), 1, 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.grass = grassC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: dirtC, ctx: dirtCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dirtCtx.fillStyle = PALETTE.DIRT; dirtCtx.fillRect(0, 0, TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dirtCtx.fillStyle = PALETTE.WOOD_D; for(let i=0; i&lt;40; i++) dirtCtx.fillRect(rand(0,31), rand(0,31), 1, 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.dirt = dirtC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: oakC, ctx: oakCtx } = createCanvas(TILE_SIZE, TILE_SIZE*2);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(oakCtx, SPRITE_MATRICES.TREE_OAK, {'L': PALETTE.LEAF_D, 'W': PALETTE.WOOD_D}, 6, 10);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>oakCtx.fillStyle = PALETTE.LEAF_L; oakCtx.fillRect(10, 12, 2, 2); oakCtx.fillRect(16, 14, 2, 2);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.tree_oak = oakC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: pineC, ctx: pineCtx } = createCanvas(TILE_SIZE, TILE_SIZE*2);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(pineCtx, SPRITE_MATRICES.TREE_PINE, {'L': PALETTE.LEAF_PINE, 'W': PALETTE.WOOD_D}, 6, 8);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.tree_pine = pineC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: bushC, ctx: bushCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(bushCtx, SPRITE_MATRICES.BUSH, {'L': PALETTE.LEAF_L}, 4, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.bush = bushC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: flowerC, ctx: flowerCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(flowerCtx, SPRITE_MATRICES.FLOWER, {'R': PALETTE.FLOWER_R, 'Y': PALETTE.FLOWER_Y, 'G': PALETTE.GRASS_L}, 10, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.flower = flowerC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: mushC, ctx: mushCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(mushCtx, SPRITE_MATRICES.MUSHROOM, {'R': PALETTE.MUSHROOM, 'W': PALETTE.WHITE}, 10, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.mushroom = mushC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: rockC, ctx: rockCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(rockCtx, SPRITE_MATRICES.ROCK, {'K': PALETTE.OUTLINE, 'M': PALETTE.STONE_M, 'L': PALETTE.STONE_L, 'D': PALETTE.STONE_D}, 8, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.rock = rockC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: rabbitC, ctx: rabbitCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(rabbitCtx, SPRITE_MATRICES.RABBIT, {'W': PALETTE.FUR_RABBIT}, 8, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.rabbit = rabbitC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: wolfC, ctx: wolfCtx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(wolfCtx, SPRITE_MATRICES.WOLF, {'G': PALETTE.FUR_WOLF}, 4, 12);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.wolf = wolfC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: bearC, ctx: bearCtx } = createCanvas(TILE_SIZE*1.5, TILE_SIZE*1.5);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(bearCtx, SPRITE_MATRICES.BEAR, {'B': PALETTE.FUR_BEAR}, 4, 10);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.bear = bearC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: deerC, ctx: deerCtx } = createCanvas(TILE_SIZE, TILE_SIZE*1.5);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(deerCtx, SPRITE_MATRICES.DEER, {'B': PALETTE.FUR_DEER}, 4, 10);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.deer = deerC;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: w1C, ctx: w1Ctx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(w1Ctx, SPRITE_MATRICES.WHEAT_GROW, { '1': PALETTE.WHEAT_1 }, 8, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.wheat_1 = w1C;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const { c: w2C, ctx: w2Ctx } = createCanvas(TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderMatrix(w2Ctx, SPRITE_MATRICES.WHEAT_READY, { '3': PALETTE.WHEAT_3 }, 8, 16);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cache.wheat_2 = w2C;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return cache;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const App = () =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [sprites, setSprites] = useState(null);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [map, setMap] = useState([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [sims, setSims] = useState([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [creatures, setCreatures] = useState([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [farms, setFarms] = useState([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [particles, setParticles] = useState([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [tribe, setTribe] = useState({ wood: 0, stone: 0, food: 100, tech: 0 });</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [weather, setWeather] = useState(WEATHER.SUNNY);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [weatherTimer, setWeatherTimer] = useState(1000);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [time, setTime] = useState(0);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [day, setDay] = useState(1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [mana, setMana] = useState(150);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [selectedId, setSelectedId] = useState(null);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [events, setEvents] = useState(['æ—äººä»°æœ›æ˜Ÿç©ºï¼Œæ•…äº‹é–‹å§‹äº†...']);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [isSoulSearching, setIsSoulSearching] = useState(false);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const [isWritingSaga, setIsWritingSaga] = useState(false);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const canvasRef = useRef(null);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const tickRef = useRef(0);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const requestRef = useRef();</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const handleSoulSearch = async (sim) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (mana &lt; 10) return;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setIsSoulSearching(true);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setMana(prev =&gt; prev - 10);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const prompt = `You are an AI storytelling engine. Roleplay as a primitive tribesman (Sign:${sim.sign}, Trait:${sim.trait}, State:${sim.state}). Generate a short inner monologue (max 15 words) in Traditional Chinese.`;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const thought = await callGemini(prompt);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (thought) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setSims(prev =&gt; prev.map(s =&gt; s.id === sim.id ? { ...s, thought: thought.trim() } : s));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setEvents(e =&gt; [`${sim.sign} çš„éˆé­‚ç™¼å‡ºäº†ä½èª...`, ...e]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setIsSoulSearching(false);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const handleTribeSaga = async () =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (mana &lt; 50) return;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setIsWritingSaga(true);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setMana(prev =&gt; prev - 50);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const prompt = `Write a cryptic, mythic, single-sentence log entry (max 20 words) for a primitive tribe in Traditional Chinese. Context: Tech Lv ${tribe.tech}, Pop ${sims.length}, Food ${Math.floor(tribe.food)}, Weather ${weather.name}.`;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const saga = await callGemini(prompt);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (saga) setEvents(e =&gt; [`ğŸ“œ å²è©©: ${saga.trim()}`, ...e]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setIsWritingSaga(false);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>useEffect(() =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setSprites(createSprites());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const newMap = [];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>for(let y=0; y&lt;MAP_HEIGHT; y++) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const row = [];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>for(let x=0; x&lt;MAP_WIDTH; x++) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const n = noise(x, y);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let type = 'GRASS';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let decoration = null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.abs(n) &gt; 1.2) type = 'MOUNTAIN';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (n &lt; -0.4) type = 'FOREST';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (n &gt; 0.8) type = 'WATER';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const dist = Math.sqrt((x-MAP_WIDTH/2)**2 + (y-MAP_HEIGHT/2)**2);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (dist &lt; 5) type = 'BASE';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (dist &gt; 9 &amp;&amp; n &gt; 0.5) type = 'WATER';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (type === 'FOREST') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.random() &gt; 0.6) decoration = 'TREE_OAK';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else decoration = 'TREE_PINE';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.random() &lt; 0.1) decoration = 'MUSHROOM';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (type === 'GRASS') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const rnd = Math.random();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (rnd &lt; 0.05) decoration = 'ROCK';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (rnd &lt; 0.1) decoration = 'BUSH';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (rnd &lt; 0.15) decoration = 'FLOWER';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>row.push({ x, y, type, decoration });</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>newMap.push(row);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setMap(newMap);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const initSims = ZODIACS.map((z, i) =&gt; ({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>id: `sim_${i}`, ...z,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>x: MAP_WIDTH/2 + rand(-2,2), y: MAP_HEIGHT/2 + rand(-2,2),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>hp: 100, hunger: 100, energy: 100,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>state: 'IDLE', targetX: null, targetY: null,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>inventory: { wood:0, food:0 },</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>thought: 'é€™è£¡å¥½å®‰éœ...',</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>animFrame: rand(0,10), dir: 1</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setSims(initSims);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const initCreatures = [];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>for(let i=0; i&lt;8; i++) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const type = Math.random() &lt; 0.4 ? 'RABBIT' : (Math.random() &lt; 0.7 ? 'DEER' : (Math.random() &lt; 0.9 ? 'WOLF' : 'BEAR'));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>initCreatures.push({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>id: `c_${i}`, type,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>x: rand(1, MAP_WIDTH-2), y: rand(1, MAP_HEIGHT-2),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>hp: type==='BEAR'?200 : type==='WOLF'?80 : 30,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>targetX: null, targetY: null,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>state: 'WANDER', animFrame: rand(0,10), dir: 1</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setCreatures(initCreatures);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, []);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const update = useCallback(() =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const isNight = time &gt; DAY_TICKS * 0.6;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tickRef.current % 10 === 0) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setWeatherTimer(prev =&gt; prev - 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (weatherTimer &lt;= 0) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const r = Math.random();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let nextW = WEATHER.SUNNY;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (r &lt; 0.3) nextW = WEATHER.RAIN;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (r &lt; 0.4) nextW = WEATHER.SNOW;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setWeather(nextW);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setWeatherTimer(rand(500, 1500));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setEvents(e =&gt; [`å¤©æ°£: ${nextW.name}`, ...e.slice(0,4)]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (weather.id !== 'SUNNY') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const pCount = weather.id === 'RAIN' ? 10 : 5;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setParticles(prev =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const newP = [];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>for(let i=0; i&lt;pCount; i++) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>newP.push({ x: rand(0, MAP_WIDTH * TILE_SIZE), y: -10, speed: weather.id === 'RAIN' ? rand(8,12) : rand(1,3), life: 100 });</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return [...prev.map(p =&gt; ({ ...p, y: p.y + p.speed, x: weather.id === 'SNOW' ? p.x + Math.sin(p.y/10) : p.x, life: p.life-1 })).filter(p =&gt; p.y &lt; MAP_HEIGHT * TILE_SIZE &amp;&amp; p.life &gt; 0), ...newP];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setParticles([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setFarms(prev =&gt; prev.map(f =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const growRate = weather.id === 'RAIN' ? 2 : (weather.id === 'SNOW' ? 0 : 1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return f.stage &lt; 100 ? { ...f, stage: Math.min(100, f.stage + 0.1 * growRate) } : f;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}));</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setCreatures(prev =&gt; prev.map(c =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (c.hp &lt;= 0) return null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let nextC = { ...c };</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tickRef.current % 20 === 0 &amp;&amp; Math.random() &lt; 0.1) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextC.targetX = Math.max(0, Math.min(MAP_WIDTH-1, c.x + rand(-3, 3)));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextC.targetY = Math.max(0, Math.min(MAP_HEIGHT-1, c.y + rand(-3, 3)));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextC.targetX !== null) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const speed = c.type === 'RABBIT' ? 0.08 : c.type === 'DEER' ? 0.06 : 0.04;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const dx = nextC.targetX - nextC.x;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const dy = nextC.targetY - nextC.y;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.abs(dx) &lt; 0.1 &amp;&amp; Math.abs(dy) &lt; 0.1) nextC.targetX = null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else { nextC.x += Math.sign(dx) * speed; nextC.y += Math.sign(dy) * speed; nextC.dir = Math.sign(dx); nextC.animFrame++; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return nextC;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}).filter(Boolean));</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setSims(prev =&gt; prev.map(s =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (s.hp &lt;= 0) return { ...s, state: 'DEAD' };</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let nextS = { ...s };</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tickRef.current % 10 === 0) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let hLoss = 0.2; let eLoss = 0.1;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (weather.id === 'SNOW' &amp;&amp; !isInBase(nextS)) eLoss *= 2;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS.hunger -= hLoss; nextS.energy -= eLoss;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.hunger &lt;= 0) nextS.hp -= 0.5;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.random() &lt; 0.02) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.hunger &lt; 30) nextS.thought = 'å¥½é¤“...';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (weather.id === 'RAIN') nextS.thought = 'ä¸‹é›¨äº†...';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (weather.id === 'SNOW') nextS.thought = 'å¥½å†·...';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const distToTarget = nextS.targetX ? Math.abs(nextS.x - nextS.targetX) + Math.abs(nextS.y - nextS.targetY) : 0;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.state === 'IDLE') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.hunger &lt; 50) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tribe.food &gt; 0 &amp;&amp; isInBase(nextS)) { setTribe(t =&gt; ({...t, food: Math.max(0, t.food-10)})); nextS.hunger = 100; nextS.thought = 'å¥½åƒï¼'; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const harvestable = farms.find(f =&gt; f.stage &gt;= 100);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (harvestable &amp;&amp; tribe.tech &gt;= 1) { nextS.state = 'FARMING'; nextS.targetX = harvestable.x; nextS.targetY = harvestable.y; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else { nextS.state = 'GATHER'; nextS.targetX = rand(1, MAP_WIDTH-2); nextS.targetY = rand(1, MAP_HEIGHT-2); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (nextS.energy &lt; 20 || (isNight &amp;&amp; !isInBase(nextS))) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS.targetX = MAP_WIDTH/2; nextS.targetY = MAP_HEIGHT/2;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (isInBase(nextS)) { nextS.state = 'SLEEP'; nextS.thought = 'ä¼‘æ¯...'; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tribe.tech &gt;= 1 &amp;&amp; Math.random() &lt; 0.05 &amp;&amp; farms.length &lt; 15) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const potentialFarm = map.flat().find(t =&gt; t.type === 'BASE' &amp;&amp; !farms.some(f =&gt; f.x===t.x &amp;&amp; f.y===t.y));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (potentialFarm) { nextS.state = 'PLANTING'; nextS.targetX = potentialFarm.x; nextS.targetY = potentialFarm.y; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.state === 'IDLE' &amp;&amp; Math.random() &lt; 0.05) { nextS.targetX = nextS.x + rand(-2, 2); nextS.targetY = nextS.y + rand(-2, 2); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (nextS.state === 'GATHER') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (distToTarget &lt; 0.5) { nextS.inventory.food += 10; nextS.state = 'IDLE'; nextS.thought = 'æ¡é›†åˆ°äº†ï¼'; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (nextS.state === 'PLANTING') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (distToTarget &lt; 0.5) { setFarms(f =&gt; [...f, { x: Math.round(nextS.x), y: Math.round(nextS.y), stage: 0 }]); nextS.state = 'IDLE'; setEvents(e =&gt; [`${nextS.sign} é–‹å¢¾è¾²ç”°`, ...e.slice(0,4)]); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (nextS.state === 'FARMING') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const cropIdx = farms.findIndex(f =&gt; Math.abs(f.x - nextS.x) &lt; 1 &amp;&amp; Math.abs(f.y - nextS.y) &lt; 1 &amp;&amp; f.stage &gt;= 100);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (cropIdx &gt;= 0) { setFarms(pF =&gt; { const nF = [...pF]; nF[cropIdx].stage = 0; return nF; }); setTribe(t =&gt; ({...t, food: t.food + 20})); nextS.state = 'IDLE'; nextS.thought = 'è±æ”¶ï¼'; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (distToTarget &lt; 0.5) nextS.state = 'IDLE';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (nextS.state === 'SLEEP') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS.energy += 0.5; if (nextS.energy &gt;= 100) { nextS.state = 'IDLE'; nextS.thought = 'ç¡é£½äº†ã€‚'; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (nextS.targetX !== null) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const dx = nextS.targetX - nextS.x; const dy = nextS.targetY - nextS.y;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.abs(dx) &lt; 0.1 &amp;&amp; Math.abs(dy) &lt; 0.1) nextS.targetX = null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const speed = (nextS.state==='SLEEP'?0:0.05) * (weather.id==='SNOW'?0.6:1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS.x += Math.sign(dx) * speed; nextS.y += Math.sign(dy) * speed;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS.animFrame++; nextS.dir = Math.sign(dx);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return nextS;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, [time, weather, farms, tribe]);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const isInBase = (sim) =&gt; Math.sqrt((sim.x - MAP_WIDTH/2)**2 + (sim.y - MAP_HEIGHT/2)**2) &lt; 5;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ç¹ªåœ–å‡½æ•¸</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const draw = useCallback(() =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const canvas = canvasRef.current;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!canvas || !sprites) return;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.imageSmoothingEnabled = false;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = '#111'; ctx.fillRect(0, 0, canvas.width, canvas.height);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.save(); ctx.scale(SCALE, SCALE);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>map.forEach(row =&gt; row.forEach(tile =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = tile.x * TILE_SIZE; const py = tile.y * TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.drawImage(sprites.grass, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tile.type === 'WATER') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = PALETTE.WATER; ctx.fillRect(px, py, TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.sin(time/20 + tile.x) &gt; 0.5) { ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.fillRect(px + 4, py + 8, 8, 2); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (tile.type === 'BASE') ctx.drawImage(sprites.dirt, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}));</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>farms.forEach(f =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = f.x * TILE_SIZE; const py = f.y * TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.drawImage(sprites.dirt, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (f.stage &gt; 80) ctx.drawImage(sprites.wheat_2, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (f.stage &gt; 20) ctx.drawImage(sprites.wheat_1, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else { ctx.fillStyle = '#8d6e63'; ctx.fillRect(px+10, py+10, 2, 2); ctx.fillRect(px+20, py+16, 2, 2); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const objects = [];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>map.forEach(row =&gt; row.forEach(tile =&gt; { if (tile.decoration) objects.push({ y: tile.y, type: 'DECO', subtype: tile.decoration, x: tile.x }); }));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>sims.forEach(sim =&gt; objects.push({ y: sim.y, type: 'SIM', data: sim }));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>creatures.forEach(c =&gt; objects.push({ y: c.y, type: 'CREATURE', data: c }));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>objects.sort((a, b) =&gt; a.y - b.y);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>objects.forEach(obj =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = obj.x * TILE_SIZE; const py = obj.y * TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (obj.type === 'DECO') {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (obj.subtype === 'TREE_OAK') ctx.drawImage(sprites.tree_oak, px, py - TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.subtype === 'TREE_PINE') ctx.drawImage(sprites.tree_pine, px, py - TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.subtype === 'ROCK') ctx.drawImage(sprites.rock, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.subtype === 'BUSH') ctx.drawImage(sprites.bush, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.subtype === 'FLOWER') ctx.drawImage(sprites.flower, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.subtype === 'MUSHROOM') ctx.drawImage(sprites.mushroom, px, py);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else if (obj.type === 'SIM') drawSim(ctx, obj.data);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (obj.type === 'CREATURE') drawCreature(ctx, obj.data);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// Selected Ring</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (selectedId) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const target = [...sims, ...creatures].find(i =&gt; i.id === selectedId);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (target) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = target.x * TILE_SIZE; const py = target.y * TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.strokeStyle = '#ffffff'; ctx.lineWidth = 1.5; ctx.setLineDash([4, 2]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.strokeRect(px, py, TILE_SIZE, TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.setLineDash([]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tribe.tech &gt;= 1) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const bx = (MAP_WIDTH/2) * TILE_SIZE; const by = (MAP_HEIGHT/2) * TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const fireSize = weather.id === 'RAIN' ? 2 : (Math.sin(time/5)*2 + 6);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (weather.id !== 'RAIN' || Math.random() &gt; 0.5) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = '#ff5722'; ctx.beginPath(); ctx.arc(bx + 16, by + 16, fireSize, 0, Math.PI*2); ctx.fill();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = '#ffca28'; ctx.beginPath(); ctx.arc(bx + 16, by + 16, fireSize/2, 0, Math.PI*2); ctx.fill();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>particles.forEach(p =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = weather.id === 'RAIN' ? '#4fc3f7' : '#ffffff';</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const w = weather.id === 'RAIN' ? 1 : 2; const h = weather.id === 'RAIN' ? 4 : 2;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillRect(p.x / SCALE, p.y / SCALE, w, h);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (time &gt; DAY_TICKS * 0.6) { ctx.fillStyle = 'rgba(10, 10, 30, 0.6)'; ctx.fillRect(0, 0, MAP_WIDTH*TILE_SIZE, MAP_HEIGHT*TILE_SIZE); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = weather.color; ctx.fillRect(0, 0, MAP_WIDTH*TILE_SIZE, MAP_HEIGHT*TILE_SIZE);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.restore();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, [map, sprites, sims, creatures, weather, particles, farms, time, selectedId, tribe]);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const drawSim = (ctx, s) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (s.state === 'DEAD') { ctx.fillStyle = '#555'; ctx.fillRect(s.x*TILE_SIZE+14, s.y*TILE_SIZE+10, 4, 12); ctx.fillRect(s.x*TILE_SIZE+10, s.y*TILE_SIZE+14, 12, 4); return; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = Math.floor(s.x * TILE_SIZE); const py = Math.floor(s.y * TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const bounce = (s.state !== 'IDLE' &amp;&amp; s.state !== 'SLEEP') ? Math.sin(s.animFrame) * 2 : 0;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const matrix = s.gender === 'M' ? SPRITE_MATRICES.CHAR_M : SPRITE_MATRICES.CHAR_F;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const colorMap = { 'H': s.hair, 'S': PALETTE.SKIN, 's': PALETTE.SKIN_SHADOW, 'C': s.color, 'K': PALETTE.OUTLINE };</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>renderMatrix(ctx, matrix, colorMap, px + 4, py + 4 + bounce);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (s.state === 'SLEEP') { ctx.font = '10px monospace'; ctx.fillStyle = '#fff'; ctx.fillText('zZ', px+20, py); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const drawCreature = (ctx, c) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const px = Math.floor(c.x * TILE_SIZE); const py = Math.floor(c.y * TILE_SIZE);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const bounce = Math.sin(c.animFrame) * 2;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let matrix, colorMap, ox=0, oy=0;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (c.type === 'RABBIT') { matrix = SPRITE_MATRICES.RABBIT; colorMap = {'W': PALETTE.FUR_RABBIT, 'K': PALETTE.OUTLINE}; ox=4; oy=10; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (c.type === 'WOLF') { matrix = SPRITE_MATRICES.WOLF; colorMap = {'G': PALETTE.FUR_WOLF, 'K': PALETTE.OUTLINE}; ox=2; oy=6; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (c.type === 'BEAR') { matrix = SPRITE_MATRICES.BEAR; colorMap = {'B': PALETTE.FUR_BEAR, 'K': PALETTE.OUTLINE}; ox=-6; oy=-6; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (c.type === 'DEER') { matrix = SPRITE_MATRICES.DEER; colorMap = {'B': PALETTE.FUR_DEER, 'K': PALETTE.OUTLINE}; ox=2; oy=-2; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.save();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (c.dir &lt; 0) { ctx.translate(px + TILE_SIZE, 0); ctx.scale(-1, 1); ctx.translate(-px, 0); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>renderMatrix(ctx, matrix, colorMap, px + ox, py + oy + bounce);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.restore();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>useEffect(() =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const loop = () =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tickRef.current++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tickRef.current % 5 === 0) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setTime(t =&gt; (t + 1) % DAY_TICKS);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (time === 0) setDay(d =&gt; d+1);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>update();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>draw();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>requestRef.current = requestAnimationFrame(loop);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>requestRef.current = requestAnimationFrame(loop);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return () =&gt; cancelAnimationFrame(requestRef.current);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, [draw, update]);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ä¿®æ­£é»æ“Šé‚è¼¯ï¼Œç¢ºä¿ç¸½æ˜¯èƒ½é»åˆ°</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const handleCanvasClick = useCallback((e) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const rect = canvasRef.current.getBoundingClientRect();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const x = (e.clientX - rect.left) / SCALE / TILE_SIZE;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const y = (e.clientY - rect.top) / SCALE / TILE_SIZE;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// å°‹æ‰¾æœ€æ¥è¿‘ä¸”åœ¨ç¯„åœå…§çš„ç›®æ¨™ (å„ªå…ˆåº¦ï¼šäºº &gt; å‹•ç‰©)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const allObjs = [...sims, ...creatures];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let closest = null;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let minDist = 2.5; // é»æ“Šåˆ¤å®šç¯„åœåŠ å¤§</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>allObjs.forEach(obj =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// ä½¿ç”¨ä¸­å¿ƒé»è¨ˆç®—è·é›¢ (x+0.5, y+0.5)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const dist = Math.sqrt((obj.x + 0.5 - x)**2 + (obj.y + 0.5 - y)**2);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (dist &lt; minDist) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>closest = obj;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>minDist = dist;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setSelectedId(closest ? closest.id : null);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, [sims, creatures]);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const castSpell = (type) =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (mana &lt; 20) return;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (['FOOD', 'HEAL', 'BUFF'].includes(type) &amp;&amp; selectedId) {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>setSims(prev =&gt; prev.map(s =&gt; {</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (s.id !== selectedId) return s;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (type === 'FOOD') { setMana(m =&gt; m - 30); setEvents(e =&gt; [`è³œäºˆ ${s.sign} é£Ÿç‰©`, ...e]); return { ...s, hunger: 100 }; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type === 'HEAL') { setMana(m =&gt; m - 30); setEvents(e =&gt; [`${s.sign} å‚·å£ç™’åˆ`, ...e]); return { ...s, hp: 100 }; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type === 'BUFF') { setMana(m =&gt; m - 30); setEvents(e =&gt; [`${s.sign} ç²å¾—ç¥åŠ›`, ...e]); return { ...s, energy: 100, thought: 'ç¥èˆ‡æˆ‘åŒåœ¨ï¼' }; }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return s;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setMana(m =&gt; m - 20);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (type === 'SUN') { setWeather(WEATHER.SUNNY); setEvents(e =&gt; ['ç¥è¹Ÿï¼šç¥ˆæ™´', ...e]); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type === 'RAIN') { setWeather(WEATHER.RAIN); setEvents(e =&gt; ['ç¥è¹Ÿï¼šç¥ˆé›¨', ...e]); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type === 'TECH') { setTribe(t =&gt; ({...t, tech: t.tech + 1})); setEvents(e =&gt; ['ç¥è¹Ÿï¼šæ™ºæ…§å•Ÿè’™', ...e]); }</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const selectedObj = [...sims, ...creatures].find(s =&gt; s.id === selectedId);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return (</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex flex-col h-screen bg-[#1a1c2c] text-[#c2c3c7]" style={{ fontFamily: PIXEL_FONT }}&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="bg-[#292b3c] p-3 border-b-4 border-[#121215] flex justify-between items-center shadow-lg shrink-0 z-20 relative"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex gap-4 items-center"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="text-[#ffcd75] font-bold flex items-center gap-2"&gt;&lt;Sparkles size={16}/&gt; {mana} Mana&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex items-center gap-2 bg-[#1a1c2c] px-3 py-1 rounded border border-[#5d4037]"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>{weather.id === 'SUNNY' ? &lt;Sun size={16} className="text-yellow-400"/&gt; : weather.id === 'RAIN' ? &lt;CloudRain size={16} className="text-blue-400"/&gt; : &lt;Snowflake size={16} className="text-white"/&gt;}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span className="text-sm"&gt;{weather.name}&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="text-xs text-gray-400"&gt;Day {day} ({time &lt; DAY_TICKS/2 ? 'AM' : 'PM'})&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex gap-2 text-xs font-bold text-[#8b9bb4]"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span&gt;ğŸ {Math.floor(tribe.food)}&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span&gt;ğŸªµ {tribe.wood}&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span&gt;ğŸ”¨ Tech Lv.{tribe.tech}&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex-1 flex flex-row overflow-hidden relative"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="relative flex-1 bg-black overflow-auto flex items-center justify-center p-4"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;canvas</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ref={canvasRef} width={MAP_WIDTH * TILE_SIZE * SCALE} height={MAP_HEIGHT * TILE_SIZE * SCALE}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>onClick={handleCanvasClick} className="border-4 border-[#3e2723] shadow-2xl cursor-crosshair"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>style={{ imageRendering: 'pixelated' }}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="absolute top-6 left-6 flex flex-col gap-1 pointer-events-none opacity-80"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>{events.slice(0, 5).map((ev, i) =&gt; (</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div key={i} className="bg-black/50 text-[#fff] px-2 py-1 text-xs rounded border-l-2 border-[#ffcd75]"&gt;{ev}&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>))}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="w-64 bg-[#292b3c] border-l-4 border-[#121215] p-4 flex flex-col gap-4 shrink-0 z-10 relative h-full overflow-y-auto"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="bg-[#1a1c2c] p-3 rounded border border-[#3e2723]"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;h3 className="text-[#ffcd75] text-sm mb-3 font-bold border-b border-[#3e2723] pb-1"&gt;ç¥è¹Ÿ (Miracles)&lt;/h3&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="grid grid-cols-2 gap-2"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('SUN')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1 transition-colors"&gt;&lt;Sun size={18} className="text-yellow-400"/&gt;&lt;span className="text-[10px]"&gt;ç¥ˆæ™´&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('RAIN')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1 transition-colors"&gt;&lt;CloudRain size={18} className="text-blue-400"/&gt;&lt;span className="text-[10px]"&gt;ç¥ˆé›¨&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('TECH')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1 transition-colors col-span-2"&gt;&lt;Brain size={18} className="text-purple-400"/&gt;&lt;span className="text-[10px]"&gt;è³œäºˆæ™ºæ…§&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button<span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>onClick={handleTribeSaga}<span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>disabled={isWritingSaga || mana &lt; 50}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>className={`bg-indigo-900 hover:bg-indigo-800 p-2 rounded flex flex-col items-center gap-1 transition-colors col-span-2 border border-indigo-500 ${isWritingSaga ? 'opacity-50 cursor-not-allowed' : ''}`}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;ScrollText size={18} className={isWritingSaga ? "animate-pulse text-indigo-300" : "text-indigo-300"}/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span className="text-[10px] text-indigo-200"&gt;âœ¨ éƒ¨è½å²è©© (50 Mana)&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex-1 bg-[#1a1c2c] p-3 rounded border border-[#3e2723] relative flex flex-col min-h-[300px]"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex justify-between items-center border-b border-[#3e2723] mb-3 pb-1"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;h3 className="text-[#8b9bb4] text-sm font-bold"&gt;è§€å¯Ÿ (Inspector)&lt;/h3&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>{selectedObj &amp;&amp; &lt;button onClick={() =&gt; setSelectedId(null)} className="text-gray-500 hover:text-white"&gt;&lt;X size={14}/&gt;&lt;/button&gt;}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>{selectedObj ? (</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex flex-col gap-2 flex-1 animate-fade-in"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>{selectedObj.sign ? (<span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex items-center gap-3"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="w-10 h-10 border border-gray-600 bg-black relative overflow-hidden flex-shrink-0"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="absolute top-2 left-2 w-6 h-6" style={{backgroundColor: selectedObj?.hair, borderRadius: '50% 50% 0 0'}}&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="absolute top-4 left-1 w-8 h-8" style={{backgroundColor: selectedObj?.color, borderRadius: '50% 50% 0 0'}}&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="font-bold text-[#ffccaa]"&gt;{selectedObj?.sign}åº§ &lt;span className="text-xs text-gray-500"&gt;({selectedObj?.gender})&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="text-[10px] text-gray-500"&gt;{selectedObj?.trait} â€¢ {selectedObj?.state}&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="space-y-1 mt-2"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex justify-between text-xs"&gt;&lt;span&gt;HP&lt;/span&gt;&lt;span&gt;{Math.floor(selectedObj?.hp || 0)}&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="h-1 bg-gray-700"&gt;&lt;div className="h-full bg-red-500" style={{width: `${selectedObj?.hp || 0}%`}}&gt;&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex justify-between text-xs"&gt;&lt;span&gt;é£½é£Ÿ&lt;/span&gt;&lt;span&gt;{Math.floor(selectedObj?.hunger || 0)}&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="h-1 bg-gray-700"&gt;&lt;div className="h-full bg-orange-500" style={{width: `${selectedObj?.hunger || 0}%`}}&gt;&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="mt-2 bg-[#111] p-2 text-xs text-[#a5d6a7] italic border border-gray-800 flex flex-col gap-2"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span&gt;"{selectedObj?.thought}"&lt;/span&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button<span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>onClick={() =&gt; handleSoulSearch(selectedObj)}<span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>disabled={isSoulSearching || mana &lt; 10}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>className="self-end flex items-center gap-1 text-[10px] bg-gray-800 hover:bg-gray-700 px-2 py-1 rounded text-purple-300 border border-purple-900 transition-colors"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;MessageCircle size={10} className={isSoulSearching ? "animate-spin" : ""}/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>âœ¨ å‚¾è½å¿ƒè² (10)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="mt-auto grid grid-cols-3 gap-2 pt-4 border-t border-[#3e2723]"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('FOOD')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1"&gt;&lt;Utensils size={16} className="text-orange-400"/&gt;&lt;span className="text-[10px]"&gt;è³œé£Ÿ&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('HEAL')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1"&gt;&lt;Heart size={16} className="text-red-400"/&gt;&lt;span className="text-[10px]"&gt;æ²»ç™’&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onClick={() =&gt; castSpell('BUFF')} className="bg-[#3e2723] hover:bg-[#5d4037] p-2 rounded flex flex-col items-center gap-1"&gt;&lt;Shield size={16} className="text-blue-400"/&gt;&lt;span className="text-[10px]"&gt;è³œç¦&lt;/span&gt;&lt;/button&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>) : (</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="font-bold text-[#ffccaa] text-lg"&gt;{selectedObj?.type}&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="text-xs text-gray-500"&gt;é‡ç”Ÿå‹•ç‰©&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="flex justify-between text-xs mt-2"&gt;&lt;span&gt;HP&lt;/span&gt;&lt;span&gt;{Math.floor(selectedObj?.hp || 0)}&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="h-1 bg-gray-700"&gt;&lt;div className="h-full bg-red-500" style={{width: `${Math.min(100, (selectedObj?.hp || 0)/2)}%`}}&gt;&lt;/div&gt;&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="mt-4 text-xs text-gray-500"&gt;é‡ç”Ÿå‹•ç‰©ç„¡æ³•ç›´æ¥æºé€šï¼Œä½†æœƒå—åˆ°ç’°å¢ƒèˆ‡å¤©æ°£çš„å½±éŸ¿ã€‚&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>)}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>) : (</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="h-full flex flex-col items-center justify-center text-gray-600 text-xs gap-2 opacity-50"&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;HelpCircle size={24} /&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div className="text-center"&gt;é»æ“Šç•«é¢ä¸­çš„è§’è‰²&lt;br/&gt;é€²è¡Œè§€å¯Ÿèˆ‡äº’å‹•&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>)}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const root = createRoot(document.getElementById('root'));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>root.render(&lt;App /&gt;);</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
